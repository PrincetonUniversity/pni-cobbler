# Docker based self configuring cobbler deployment
This is a docker container and compose set implementing a cobbler server with a small auto-importer layered on top to allow injest of yaml file.  These files have a simple syntax that could be easily generated from other sources as desired.


## Basic Configuration
This system relies on the software package 'supervisord' to manage an array of three separate processes in order to make cobbler function as expected. This includes an apache server, tftpd server, and the cobbler management software itself.  Additionally a one of task is run after the services are loaded to import structured data from the folder `/opt/import`, this is expected to be a mounted volume with site specific configurations added.

## Cobblerdata Folder
To make this system work, you must supply a folder mounted `/opt/import` inside the container that contains the data to be loaded into the system on creation of the container. A reference version is maintained at `./cobblerdata-reference` *HOWEVER:* this dataset is incomplete, the distro entries will not work unless the required `vmlinuz` and `initrd.img` are downloaded to their respective folders.

## Kickstart and Snippet Files
Kickstart files used by cobbler are not standard kickstart files and this is useful to remember when designing them. They are infact cheetah templates, capable of variable substitution, light meta programming, and file inlining(via SNIPPETS). Documentation can be found [here](https://cobbler.readthedocs.io/en/release28/3_general/kickstart%20templating.html).

Any files placed in the `cobblerdata` kickstart and kickstart-snippet folders will be copied into the required locations on


## Notes:
* initially the plan was to configure this to use traefik for ssl termination and force the system behind an SSO solution provided by upstream OIT. This has been abandon for now due to limitations in how cobbler handles tls locally and remotely as well as a number of idiosyncrasies in how the web interface functions.
 * Making this work would require at minimum dynamically dumping certs generated by traefik out to disk, then re-injesting them into the cobbler image. A solution that is completely non-portable and a maintenance burden due to the replacement frequency seen with letsencrypt certs.


## TODOs:
* currently the forklift script runs on each start of the container, if the container is restarted instead of torn down and recreated this may result in strange behavior. This is due to the 'add' commands not currently being equipped as 'update or add' commands. A 'run once' guarantee should be added for the near term and long term making base.py and forklift handle this indepotently would be better.
* on this, safety checks need to be added end to end for importing data and cloning files so that we aren't just erroring out but instead offering meaningful errors. Admittedly as an internal tool this is a lower priority but something that needs adding.
